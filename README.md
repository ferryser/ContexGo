# ContexGo: Context-Aware Task State Agent

> **Capture. Structure. Align.**
>
> ä¸€ä¸ªæœ¬åœ°ä¼˜å…ˆçš„åˆ†å¸ƒå¼ä¸Šä¸‹æ–‡æ™ºèƒ½ä½“ã€‚æ—¨åœ¨é€šè¿‡å·¥ç¨‹åŒ–æ‰‹æ®µï¼Œå°†éç»“æ„åŒ–çš„è¡Œä¸ºæµè½¬æ¢ä¸ºå¯ç»„åˆã€å¯æ¼”ç®—çš„ä»»åŠ¡çŠ¶æ€ï¼ŒååŠ©ç”¨æˆ·é€šè¿‡æ—¶é—´ç¢ç‰‡çš„æœ‰åºå †å ï¼Œå®ç°ä»å¾®è§‚è¡Œä¸ºåˆ°å®è§‚ç›®æ ‡çš„å¯¹é½ã€‚

[![License: AGPL v3](https://img.shields.io/badge/License-AGPL_v3-blue.svg)](https://www.gnu.org/licenses/agpl-3.0)
[![Status: Architectural Design](https://img.shields.io/badge/Status-Blueprint_Phase-blue)]()

---

## 1. åˆæ­¥è®¾è®¡å›¾æ™¯ (Preliminary Vision)

æœ¬é¡¹ç›®è‡´åŠ›äºæ„å»ºä¸€ä¸ª**å¯æŒç»­çš„ä¸ªäººæ—¶é—´ç»„åˆç³»ç»Ÿ**ã€‚å®ƒä¸æ»¡è¶³äºä»…ä»…è®°å½•â€œæ—¶é—´å¼€é”€â€ï¼Œè€Œæ˜¯è¯•å›¾æ„å»ºä¸€ä¸ª**â€œæ•°å­—ç¬¬äºŒå¤§è„‘â€çš„ç´¢å¼•å±‚**ã€‚

ç³»ç»Ÿè®¾è®¡éµå¾ªä»¥ä¸‹æ ¸å¿ƒåŸåˆ™ï¼š
* **ä»ç®€å…¥ç¹ (Progressive Complexity):** å°†åº•å±‚çš„ç¦»æ•£è¾“å…¥ï¼ˆIOä¿¡å·/å±å¹•ä¿¡æ¯ï¼‰æŠ½è±¡ä¸ºåŸå­åŒ–çš„â€œçŠ¶æ€â€ï¼Œè¿›è€Œèšåˆä¸ºâ€œä¼šè¯â€ï¼Œæœ€ç»ˆæ˜ å°„è‡³é•¿æœŸçš„â€œç›®æ ‡â€ã€‚
* **ç®¡ç†å³ç´¢å¼• (Management as Index):** â€œä»»åŠ¡åˆ†ç±»â€æ˜¯ç‰©ç†å®¹å™¨ï¼Œâ€œå¿ƒç†åˆ†æâ€æ˜¯æ³¨å…¥å…¶ä¸­çš„è¯­ä¹‰çµé­‚ã€‚
* **åˆ†å¸ƒå¼ä¸€è‡´æ€§ (Distributed Consistency):** åˆ©ç”¨ CRDT ä¸è™šæ‹Ÿç»„ç½‘ï¼Œåœ¨å¤šè®¾å¤‡ç¯å¢ƒä¸‹ç»´æŠ¤ç»Ÿä¸€çš„å·¥ä½œæµè§†å›¾ï¼Œæ¶ˆé™¤ç‰©ç†éš”é˜‚ã€‚

---

## 2. æ ¸å¿ƒæŠ½è±¡ (Core Abstractions)

ç³»ç»Ÿä¸ç›´æ¥ç®¡ç†æ—¶é—´ï¼Œè€Œæ˜¯ç®¡ç†**çŠ¶æ€ (State)**ã€‚ç³»ç»Ÿè®¾è®¡éµå¾ªä»¥ä¸‹ä¸‰å±‚æŠ½è±¡æ¨¡å‹ï¼š

### L0: ä¿¡å·å±‚ (Signal Layer)
* **å®šä¹‰:** ç‰©ç†ä¸–ç•Œä¸æ•°å­—äº¤äº’ç•Œé¢çš„åŸå§‹æŠ•å½±ã€‚
* **ç‰¹å¾:** é«˜é¢‘ã€ç¦»æ•£ã€æ— è¯­ä¹‰ã€æ˜“å˜ã€‚
* **ç»„æˆ:** çª—å£å¥æŸ„å˜åŒ–ã€è¾“å…¥è®¾å¤‡æ´»è·ƒåº¦ (HID Activity)ã€å±å¹•å†…å®¹çš„ç‰¹å¾å‘é‡ (Feature Vectors)ã€‚

### L1: çŠ¶æ€å±‚ (State Layer)
* **å®šä¹‰:** åŸºäºä¿¡å·ç‰¹å¾åˆ†ç±»å¾—å‡ºçš„åŸå­åŒ–æ—¶é—´åˆ‡ç‰‡ã€‚
* **ç‰¹å¾:** ç»“æ„åŒ–ã€å¯æšä¸¾ã€å…·å¤‡åŸºç¡€å±æ€§ï¼ˆåˆ†ç±»ã€æŠ•å…¥åº¦ï¼‰ã€‚
* **é€»è¾‘:** é€šè¿‡æœ¬åœ°è§„åˆ™å¼•æ“æˆ–è½»é‡çº§åˆ†ç±»ç®—æ³•ï¼Œå°† L0 ä¿¡å·æ˜ å°„ä¸ºç‰¹å®šçš„ `TaskState` (e.g., `Coding`, `Meeting`, `Idle`)ã€‚è¿™æ˜¯ç³»ç»Ÿè¿›è¡ŒåŒæ­¥å’ŒåŸºç¡€ç»Ÿè®¡çš„æœ€å°å•å…ƒã€‚

### L2: è®¤çŸ¥å±‚ (Cognitive Layer)
* **å®šä¹‰:** å¯¹è¿ç»­çŠ¶æ€æµçš„è¯­ä¹‰è§£é‡Šä¸ç›®æ ‡åå·®åˆ†æã€‚
* **ç‰¹å¾:** è¯­å¢ƒåŒ–ã€é•¿å‘¨æœŸã€å…·å¤‡å¿ƒç†ä¾§å†™å±æ€§ã€‚
* **é€»è¾‘:** åˆ©ç”¨å¤§æ¨¡å‹ (LLM) åˆ†æ L1 çŠ¶æ€åºåˆ—ï¼Œè¯†åˆ«è¡Œä¸ºæ¨¡å¼ï¼ˆå¦‚â€œå¿ƒæµâ€ã€â€œç„¦è™‘åˆ‡æ¢â€ï¼‰ï¼Œå¹¶è¯„ä¼°å…¶å¯¹é¢„è®¾ç›®æ ‡çš„è´¡çŒ®åº¦ã€‚

---

## 3. ç³»ç»Ÿæ¶æ„è¯¦è§£ (System Architecture)

ç³»ç»Ÿé‡‡ç”¨ **"æœ¬åœ°è®¡ç®—æ ¸å¿ƒ + äº‘ç«¯è®¤çŸ¥å¢å¼º + è™šæ‹Ÿç»„ç½‘åŒæ­¥"** çš„æ··åˆæ¶æ„ã€‚

### ğŸ›¡ï¸ Module I: Sentinel (æœ¬åœ°æ„ŸçŸ¥)
*è½»é‡åŒ–ï¼Œæ—  GPU ä¾èµ–*
* **Smart Monitor:** ç›‘å¬çª—å£å¥æŸ„ä¸é”®é¼ æ´»è·ƒåº¦ï¼Œé‡‡ç”¨â€œäº‹ä»¶é©±åŠ¨â€ç­–ç•¥é¿å…æ— æ•ˆè½®è¯¢ã€‚
* **Local Tokenizer:**
    * **Accessibility API:** ç›´æ¥è¯»å– UI æ ‘è·å–æ–‡æœ¬ï¼ˆVSCode æ–‡ä»¶å, æµè§ˆå™¨ URLï¼‰ï¼Œé›¶ç®—åŠ›æ¶ˆè€—ã€‚
    * **Windows OCR:** ä»…åœ¨å¿…è¦æ—¶è°ƒç”¨æœ¬åœ°ç¦»çº¿ OCR å¼•æ“æå–å›¾åƒæ–‡æœ¬ã€‚
    * **Privacy Lock:** åŸå§‹æˆªå›¾åœ¨æå–æ–‡æœ¬åç«‹å³å†…å­˜é”€æ¯ï¼Œç»ä¸è½ç›˜ï¼Œç»ä¸ä¸Šä¼ ã€‚

### âš™ï¸ Module II: Processing (ç»“æ„åŒ–)
* **Time Aggregator:** å°†ç¦»æ•£çš„é‡‡æ ·ç‚¹èšåˆä¸º 5 åˆ†é’Ÿç²’åº¦çš„ **TimeWindow** å¯¹è±¡ã€‚
* **Context Clustering:** åœ¨æœ¬åœ°è¿›è¡Œåˆæ­¥çš„è§„åˆ™èšç±»ï¼ˆå¤åˆ» MineContext ç®—æ³•ï¼Œå¦‚è¯†åˆ« Project A vs Project Bï¼‰ï¼Œå‡å°‘å‘å¾€äº‘ç«¯çš„ Token æ•°é‡ã€‚

### ğŸ”„ Module III: Synchronization (å¤šç«¯åŒæ­¥)
* **Network Transport:** ä¾èµ– **Tailscale** æä¾›çš„è™šæ‹Ÿå±€åŸŸç½‘ç¯å¢ƒï¼Œå®ç°å¼€ç®±å³ç”¨çš„ P2P é€šä¿¡ï¼Œæ— éœ€å¤„ç†å…¬ç½‘ NATã€‚
* **CRDT Engine:** ä½¿ç”¨ **y-py** (Yjs) ç®¡ç†åˆ†å¸ƒå¼çŠ¶æ€ï¼Œç¡®ä¿æ•°æ®æœ€ç»ˆä¸€è‡´æ€§ã€‚
* **Timeline Merging:** æ™ºèƒ½åˆå¹¶å¤šè®¾å¤‡çŠ¶æ€ã€‚
    * *åœºæ™¯:* æ­¤æ—¶ PC (Ryzen) å¤„äº Idleï¼ŒLaptop å¤„äº Coding -> åˆå¹¶ç»“æœä¸º Codingï¼ˆæœ€å¤§æŠ•å…¥åº¦ä¼˜å…ˆï¼‰ã€‚

### â˜ï¸ Module IV: Brain (äº‘ç«¯å¤§è„‘)
* **Cloud Client:** å…¼å®¹ OpenAI æ¥å£æ ‡å‡†çš„å®¢æˆ·ç«¯ï¼ˆæ”¯æŒ DeepSeek, Moonshot, ChatGPTï¼‰ã€‚
* **Analyst:** å‘¨æœŸæ€§ï¼ˆå¦‚æ¯ 15 åˆ†é’Ÿï¼‰å‘é€å‹ç¼©åçš„ JSON æ‘˜è¦ï¼ˆåŒ…å«æ‰€æœ‰å·²åŒæ­¥è®¾å¤‡çš„åˆå¹¶ä¸Šä¸‹æ–‡ï¼‰ï¼Œè¯·æ±‚äº‘ç«¯è¿›è¡Œæ·±åº¦å¿ƒç†æ¨ç†ã€‚
* **Gatekeeper:** åŒé‡ç†”æ–­æœºåˆ¶ï¼ˆPre-flight è„±æ•/æ‹¦æˆªï¼ŒPost-flight å¹»è§‰è¿‡æ»¤ï¼‰ã€‚

### ğŸ–¥ï¸ Module V: Interaction (Flet UI)
* **Dashboard:** å¯è§†åŒ–å±•ç¤ºå¤šç«¯åˆå¹¶åçš„æ—¶é—´è½´ä¸äº‘ç«¯ç”Ÿæˆçš„ Insightã€‚
* **Intervention:** Windows ç³»ç»Ÿçº§å¼¹çª—ã€‚ä»…åœ¨ Gatekeeper æ”¾è¡Œé«˜ç½®ä¿¡åº¦å»ºè®®æ—¶è§¦å‘ã€‚

---

## 4. åˆæ­¥æŠ€æœ¯é€‰å‹ (Preliminary Tech Stack)

| æ¨¡å— | å…³é”®æŠ€æœ¯ | é€‰å‹ç†ç”± |
| :--- | :--- | :--- |
| **Language** | **Python 3.10+** | èƒ¶æ°´è¯­è¨€ï¼Œç”Ÿæ€ä¸°å¯Œï¼Œå®Œç¾é€‚é… AI ä¸ UI å¼€å‘ã€‚ |
| **GUI Framework** | **Flet** | Python wrapper for Flutterï¼Œå¼€å‘æ•ˆç‡é«˜ï¼Œæ€§èƒ½è¶³å¤Ÿï¼Œæ”¯æŒåŸç”Ÿçª—å£ç‰¹æ€§ã€‚ |
| **Sync Engine** | **y-py** | åŸºäº Rust çš„é«˜æ€§èƒ½ CRDT åº“ï¼Œå·¥ä¸šçº§åˆ†å¸ƒå¼ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆã€‚ |
| **Networking** | **Tailscale** | è™šæ‹Ÿç»„ç½‘å·¥å…·ï¼Œé›¶é…ç½®å®ç° NAT ç©¿é€ä¸ P2P åŠ å¯†é€šä¿¡ã€‚ |
| **Cognitive Core** | **DeepSeek-V3** | (ç»ç”± OpenAI SDK) æé«˜æ€§ä»·æ¯”çš„äº‘ç«¯æ¨ç†å¼•æ“ï¼Œé€‚åˆé«˜é¢‘æ—¥å¿—åˆ†æã€‚ |
| **Perception** | **MSS / Win32 API** | æ¯«ç§’çº§å±å¹•å·®åˆ†ä¸å¥æŸ„è·å–ï¼Œæä½èµ„æºå ç”¨ã€‚ |
| **OCR Engine** | **Windows.Media.Ocr** | æ“ä½œç³»ç»Ÿå†…ç½® OCRï¼Œç¦»çº¿ã€å…è´¹ã€éšç§å®‰å…¨ã€‚ |
| **Data Storage** | **SQLite** | å•æ–‡ä»¶ç»“æ„åŒ–å­˜å‚¨ï¼Œæ•°æ®ä¸»æƒå®Œå…¨åœ¨æœ¬åœ°ã€‚ |

---

## 5. å¼€å‘è·¯çº¿å›¾ (Development Roadmap)

### Phase 0: åŸºç¡€è®¾æ–½ (Infrastructure)
* [ ] å®šä¹‰æ ¸å¿ƒæ•°æ®æ¨¡å‹ (`TaskState`, `Event`)ã€‚
* [ ] é…ç½® SQLite ORM ä¸æ•°æ®åº“è¿ç§»ã€‚
* [ ] **éªŒè¯ Tailscale + WebSocket P2P è¿é€šæ€§ã€‚**

### Phase 1: æ„ŸçŸ¥ä¸æœ¬åœ°çŠ¶æ€ (Sentinel & L1)
* [ ] å®ç° `WindowWatcher` (å¥æŸ„) ä¸ `InputMonitor` (æ´»è·ƒåº¦)ã€‚
* [ ] ç§»æ¤ MineContext æ ¸å¿ƒç®—æ³•ï¼Œå®ç° `Raw Events -> TimeWindow` çš„èšåˆã€‚
* [ ] è¾“å‡ºï¼šä¸€ä¸ªèƒ½ç”Ÿæˆæœ¬åœ° JSON æ—¥å¿—çš„ CLI å·¥å…·ã€‚

### Phase 2: UI åŸå‹ (Dashboard)
* [ ] æ­å»º Flet ä¸»æ¡†æ¶ã€‚
* [ ] å®ç°æ—¶é—´è½´ç»„ä»¶å¯è§†åŒ–ã€‚
* [ ] å®ç°ç³»ç»Ÿæ‰˜ç›˜ä¸åå°é©»ç•™é€»è¾‘ã€‚

### Phase 3: äº‘ç«¯å¤§è„‘ (Brain)
* [ ] é›†æˆ OpenAI SDK (é€‚é… DeepSeek)ã€‚
* [ ] ç¼–å†™ Gatekeeper (å»æ•/æ‹¦æˆª) é€»è¾‘ã€‚
* [ ] Prompt Engineeringï¼šè®© AI å­¦ä¼šé˜…è¯» JSON å¹¶è¾“å‡ºå¿ƒç†åˆ†æã€‚

### Phase 4: å¤šç«¯åŒæ­¥ (Sync)
* [ ] å¼•å…¥ `y-py`ã€‚
* [ ] å°† SQLite æ•°æ®å±‚æ”¹é€ ä¸ºæ”¯æŒ CRDT çš„å­˜å‚¨å±‚ã€‚
* [ ] è”è°ƒå¤šç«¯æ•°æ®åˆå¹¶é€»è¾‘ã€‚

---

## 6. ä¼ æ„Ÿå™¨æµ‹è¯• UI (Sensor Test UI)

åœ¨ Windows ä¸‹å¯é€šè¿‡åŒå‡»è„šæœ¬å¯åŠ¨ä¼ æ„Ÿå™¨æµ‹è¯•ç•Œé¢ï¼Œè„šæœ¬ä¼šåœ¨éœ€è¦æ—¶å…ˆå¯åŠ¨åç«¯æœåŠ¡ï¼ˆ`python -m contexgo.main`ï¼‰ï¼Œå†å¯åŠ¨ UIï¼š

1. å®‰è£…ä¾èµ–ï¼ˆæ¨èåœ¨è™šæ‹Ÿç¯å¢ƒå†…æ‰§è¡Œï¼‰ï¼š
   ```bash
   python -m pip install -e .
   ```
2. åŒå‡»è¿è¡Œï¼š
   ```
   nexus/test_sensor/run_ui.bat
   ```

> è‹¥å¸Œæœ›æ‰‹åŠ¨å¯åŠ¨ï¼š
> - åç«¯ï¼š`python -m contexgo.main`
> - UIï¼š`python -m nexus.test_sensor` æˆ– `python nexus/test_sensor/app.py`

## 7. åè®® (License)

**apache 2.0**
